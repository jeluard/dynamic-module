Dynamic Module allows to programmatically discover/manipulate [Mule modules](http://www.mulesoft.org/muleforge/cloud-connectors) generated by [Mule devkit](http://www.mulesoft.org/documentation/display/DEVKIT/Home).

# Discovery

A module Jar plus all its dependencies can retrieved/locally installed using maven coordinates. Under the hoof [MuleForge](http://www.mulesoft.org/muleforge) will be accessed, dependencies resolved, artifacts downloaded and locally installed.

```java
final List<URL> urls = new MuleForgeDiscovery().listDependencies("artifactId", "version");
//urls is the List of module Jar plus all its dependencies (locally available ).
```

# Invocation

A MessageProcessor can be simply invoked using an Invoker.

```java
final MessageProcessor messageProcessor = ...;
final Object muleModule = ...;
final Map<Module.Parameter, Object> parameterValues = ...;
        
final Invoker invoker = new Invoker(messageProcessor, module, parameterValues, 5);
invoker.initialise();
final Object result = invoker.invoke(message);
invoker.close();
```

It might be more convenient to load all Processors dynamically once and executed them using the same `name` you would use in your xml application.
A ModuleInvoker will handle Invoker lifecycle for you.

```java
final Module module = new JarLoader().load(urls);
//Setup this module if needed. For instance Connector will need credentials to be injected.

final ModuleInvoker moduleInvoker = new ModuleInvoker(module, parameters);
moduleInvoker.invoke("name", message);
moduleInvoker.close();
```

Module description can be generated from your module Jar.

```java
final Module module = new JarLoader().load(urls);
```

# Example

```java
final List<URL> urls = new MuleForgeDiscovery().listDependencies("mule-module-sfdc", "4.0-SNAPSHOT");

final Connector connector = (Connector) new JarLoader().load(urls);
connector.setUsername("username");
connector.setPassword("password");
connector.setSecurityToken("securityToken");

final Map<String, Object> parameters = new HashMap<String, Object>();
parameters.put("url", new URL("https://test.salesforce.com/services/Soap/u/23.0"));

final ModuleInvoker moduleInvoker = new ModuleInvoker(module, parameters);

final Map<String, Object> methodParameterValues = new HashMap<String, Object>();
methodParameterValues.put("type", "type");
methodParameterValues.put("objects", new LinkedList<Map<String, Object>>());

moduleInvoker.invoke("create", methodParameterValues);
moduleInvoker.close();
```